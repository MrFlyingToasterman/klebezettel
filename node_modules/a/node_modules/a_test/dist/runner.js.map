{"version":3,"sources":["../src/runner.js"],"names":[],"mappings":";;;;;;;;AAAA;;;;AACA;;;;AACA;;IAAY,W;;AACZ;;;;AACA;;;;;;;;;;IAEqB,M;AAEpB,mBAE0B;AAAA,MAFd,UAEc,yDAFD,EAAE,MAAM,OAAR,EAEC;AAAA,MADzB,gBACyB,yDADN,gCACM;AAAA,MAAzB,QAAyB;;AAAA;;AAEzB,OAAK,WAAL,GAAmB,UAAnB;AACA,OAAK,iBAAL,GAAyB,gBAAzB;AACA,OAAK,SAAL,GAAiB,QAAjB;AACA;;;;sBAEG,Y,EAAc;AACjB,OAAI,cAAc,aAAG,WAAH,CAAe,YAAf,CAAlB;AACA,QAAK,aAAL,CAAmB,YAAnB,EAAiC,WAAjC;AACA,QAAK,WAAL,CAAiB,YAAjB,EAA+B,WAA/B;AACA;;;gCAEa,Y,EAAc,W,EAAa;AAAA;;AACxC,eACE,MADF,CACS;AAAA,WAAQ,UAAS,IAAT,CAAc,IAAd;AAAR;AAAA,IADT,EAEE,GAFF,CAEM;AAAA,WAAQ,eAAK,IAAL,CAAU,YAAV,EAAwB,IAAxB,CAAR;AAAA,IAFN,EAGE,MAHF,CAGS;AAAA,WAAW,aAAG,QAAH,CAAY,OAAZ,EAAqB,MAArB,EAAX;AAAA,IAHT,EAIE,OAJF,CAIU,mBAAW;AACnB,UAAK,eAAL,CAAqB,OAArB;AACA,gBAAY,KAAZ,CAAkB,MAAlB;AACA,IAPF;AAQA;;;kCAEe,O,EAAS;AACxB,OAAI;AACH,SAAK,WAAL,CAAiB,IAAjB,CAAsB,OAAtB;AACA,IAFD,CAEE,OAAO,CAAP,EAAU;AACX,QAAI,YAAY,KAAK,iBAAL,CAAuB,KAAvB,CAA6B,OAA7B,CAAhB;AACA,SAAK,SAAL,CAAe,gBAAf,CAAgC,SAAhC,EAA2C,CAA3C;AACA;AACD;;;8BAEW,Y,EAAc,W,EAAa;AAAA;;AACtC,eACE,MADF,CACS;AAAA,WAAQ,SAAS,cAAjB;AAAA,IADT,EAEE,GAFF,CAEM;AAAA,WAAQ,eAAK,IAAL,CAAU,YAAV,EAAwB,IAAxB,CAAR;AAAA,IAFN,EAGE,MAHF,CAGS;AAAA,WAAW,aAAG,QAAH,CAAY,OAAZ,EAAqB,WAArB,EAAX;AAAA,IAHT,EAIE,OAJF,CAIU;AAAA,WAAW,OAAK,GAAL,CAAS,OAAT,CAAX;AAAA,IAJV;AAKA;;;;;;kBA3CmB,M","file":"runner.js","sourcesContent":["import fs from 'fs';\nimport path from 'path';\nimport * as cacheHelper from './cacheHelper';\nimport realReporter from './reporter';\nimport SuiteNameBuilder from './suiteNameBuilder';\n\nexport default class Runner {\n\n\tconstructor(testLoader = { load: require },\n\t\tsuiteNameBuilder = new SuiteNameBuilder(),\n\t\treporter = realReporter) {\n\n\t\tthis._testLoader = testLoader;\n\t\tthis._suiteNameBuilder = suiteNameBuilder\n\t\tthis._reporter = reporter;\n\t}\n\n\trun(entryDirPath) {\n\t\tlet dirContents = fs.readdirSync(entryDirPath)\n\t\tthis._runTestFiles(entryDirPath, dirContents);\n\t\tthis._runSubdirs(entryDirPath, dirContents)\n\t}\n\n\t_runTestFiles(entryDirPath, dirContents) {\n\t\tdirContents\n\t\t\t.filter(item => /^when/i.test(item))\n\t\t\t.map(item => path.join(entryDirPath, item))\n\t\t\t.filter(absPath => fs.statSync(absPath).isFile())\n\t\t\t.forEach(absPath => {\n\t\t\t\tthis._tryRunTestFile(absPath);\n\t\t\t\tcacheHelper.clear(module);\n\t\t\t});\n\t}\n\n\t_tryRunTestFile(absPath) {\n\t\ttry {\n\t\t\tthis._testLoader.load(absPath);\n\t\t} catch (e) {\n\t\t\tlet suiteName = this._suiteNameBuilder.build(absPath);\n\t\t\tthis._reporter.notRunnableSuite(suiteName, e);\n\t\t}\n\t}\n\n\t_runSubdirs(entryDirPath, dirContents) {\n\t\tdirContents\n\t\t\t.filter(item => item !== 'node_modules')\n\t\t\t.map(item => path.join(entryDirPath, item))\n\t\t\t.filter(absPath => fs.statSync(absPath).isDirectory())\n\t\t\t.forEach(absPath => this.run(absPath));\n\t}\n\n}\n"]}